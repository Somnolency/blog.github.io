<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

    <title>环保人格测试网站</title>
    <link rel="stylesheet" href="css/ask.css">
</head>

<body>
    <div class="container">
        <div class="form-box">
            <div class="question-box hidden">
                <h1>题目编号</h1>
                <button id="select_a" style="display: none">A选项</button>
                <button id="select_b" style="display: none">B选项</button>
                <button id="select_c" style="display: none">C选项</button>
                <button id="select_d" style="display: none">D选项</button>
                <button id="select_e" style="display: none">E选项</button>
                <button id="select_f" style="display: none">F选项</button>
                <button id="last_question" style="display: none">上一题</button>
                <button id="complete_question" style="display: none">查看结果</button>
            </div>
            <!-- 登录 -->
            <div class="home-box">
                <h1 id="home_title">环保人格测试</h1>
                <h2 id="home_figure" style="display: block;">人格名称</h2>
                <button id="start_test">开始测试</button>
                <p id="figure_exp"></p>
            </div>
        </div>
        <div class="con-box left">
            <h2 id="complete_h2">看看<span>测试题</span></h2>
            <h3 id="complete_h3">快来领取你的专属<span>环保形象</span>吧</h3>
<!--            <h3 id="complete_figure_h3" style="display: none">你的环保人格是: </h3>-->
<!--            <p id="complete_character_exp" style="display: none"></p>-->
            <p id="question_text"></p>
            <img src="images/3.jpg" alt="" id="img_left">
            <p></p>
            <button id="login">退出答题</button>
        </div>
        <div class="con-box right">
            <h2 id="con_right_h">欢迎测试<span>环保人格</span></h2>
            <p id="con_right_p">快来看看你的<span>环保人格</span>吧</p>
            <img src="images/4.jpg" alt="" id="img_right">
            <p></p>
            <button id="register" style="display: none">重新测试</button>
        </div>
    </div>
    <script>
         // 创建一个刷新选项函数，通过读取当前题目编号进行选项的显示，对选项的显
         // 示通过替换question_box的内容来确定
         // question_box中每个选项应具有:内容、各个环保属性得分，以及对应的点击事件
         // 选项对应的点击事项不需要刷新，可以一开始就写完所有的点击事件，只要选项不
         //显示就没法触发点击事件
         // 在上一题按钮中要实现刷新选项以及题目的功能，也要能够对历史得分进行回
         //溯
         // 实现得分回溯功能需要一个计分数组，储存在第N个题目时的分数
         // 在普通选项按钮中要实现刷新选项以及题目的功能、分数计算的功能
         // 分数计算通过获取题目编号获取上一题分数，然后与选项分数相加后，写入当
         //前题目分数
         // 最后是分数总结函数
         // 题目与分数的格式为: q_all[0] = [问题,[选项1,c_1,c_2,c_3,c_4],[选项1,c_1,c_2,c_3,c_4]]
         // 每个序列都有一个问题，至少两个选项，每个选项对应有4个分数


         // 得分数组定义
         // 分数分类: 低调执念者|野生循环家|绿色买单人|积分收割机
         let score_history = [];
         // 得分初始化函数, 必须有一个order=0的数据表示第一题开始前的分数
         function scoreInit(number_of_question,number_of_score_type) {
             for (let _i = 0; _i < number_of_question+1; _i++) {
                 score_history[_i] = [];
                 for (let _j = 0; _j < number_of_score_type; _j++)
                     score_history[_i][_j] = 0;
             }
             // alert("score init succeed!");
         }

         // 初始化正在回答的题目的编号
         let order = 1;

         // 计算分数时要考虑order=0的初始化分数
         function scoreCalc(q_order, character_1, character_2, character_3, character_4) {
             // alert("开始计算分数");
             // alert("order: ");
             // alert(q_order);
             // 上一题的总得分q_order-2,本题得分q_order-1
             // alert("score_history_last: "); alert(score_history[q_order-2][3]);
             // alert("score_character_4: "); alert(character_4);
             // 分数初始化有问题
             score_history[q_order-1][0] = score_history[q_order-2][0]+character_1*1;
             score_history[q_order-1][1] = score_history[q_order-2][1]+(character_2)*1;
             score_history[q_order-1][2] = score_history[q_order-2][2]+(character_3)*1;
             score_history[q_order-1][3] = score_history[q_order-2][3]+(character_4)*1;
             // alert("score_history_new: "); alert(score_history[q_order-1][3]);
             // alert("结束计算");
         }

         // let q_all = [
         //     ["在一家提供一次性和消毒筷子的餐厅是，我会选择？",["一次性筷子", -1, -1,-1,-1],["消毒筷子",1, 0,0,1]],
         //     ["购物时，我会自带以下材质的购物袋", ["塑料",0, 1,0,2],["布质",+1, 0,0,3],["不自带",-1,-1,-1,4]],
         // ]
         let q_all = [
             ["在一家提供一次性和消毒筷子的餐厅是，我会选择？",["一次性筷子", -1, -1,-1,-1],["消毒筷子",1, 0,0,0]],
             ["购物时，我会自带以下材质的购物袋", ["塑料",0, 1,0,0],["布质",1, 0,0,0],["不自带",-1,-1,-1,-1]],
             ["在餐厅吃饭时，如果有剩菜，我一般会打包吗？", ["会",1,0,0,0],["不会",0,0,0,0]],
             ["假如在家里，你有废纸、一次性饭盒、塑料袋这三样垃圾，我会选择扔掉哪些：", ["全部",0,0,0,0],["其中一样",0,0,0,0],["其中两样",0,1,0,0],["都不扔，下次再用",0,2,0,0]],
             ["如果我需要离开房间五分钟，我会随手关灯吗？",["会",1,0,0,0],["不会",0,0,0,0]],
             ["我有收集塑料袋当作垃圾袋的习惯吗？",  ["有",0,0,0,0],["没有",0,1,0,0]],
             ["夏天空调温度我会调到多少度？", ["27度",2,0,0,0],["26度",1,0,0,0],["随意",0,0,0,0],["17度",0,0,0,0]],
             ["我家里的空调是多少级能效？", ["一级",0,0,2,0],["二级",0,0,1,0],["三级",0,0,0,0],["四级",0,0,0,0],["五级",0,0,0,0]],
             ["我家里的冰箱是多少级能效？", ["一级",0,0,1,0],["二级",0,0,0,0],["三级",0,0,0,0]],
             ["我家里的有多少环保产品？", ["无",0,0,0,0],["1~2",0,0,1,0],["3~4",0,0,2,0],["4件以上",0,0,3,0]],
             ["我有捐赠步数的习惯吗？", ["经常",0,0,0,2],["偶尔",0,0,0,1],["没有",0,0,0,0]],
             ["我的蚂蚁森林的总能量约有多少？", ["1000kg以上",0,0,0,5],["800kg-999.99kg",0,0,0,4],["500kg-799.99kg",0,0,0,3],["100kg-499.99kg",0,0,0,2],["50kg-99.99kg",0,0,0,1],["50kg以下",0,0,0,0]],
         ]

         // 重加载第order次序列的信息,q_all是数据信息,order是问题次序
         // 每个序列都有一个问题，至少两个选项，每个选项对应有4个分数
         // q_all[0] = [问题,[选项1,c_1,c_2,c_3,c_4],[选项1,c_1,c_2,c_3,c_4]]
         function optReload(q_all, order) {
             // alert("optReload启动");
             // alert("order = ");
             // alert(order);
             // 上一道题按钮的显隐控制
             let _order = order-1; // 这里的序列从0开始
             if (_order<0) alert("题目序列从1开始！")
             else if (_order===0)
                 question_box.getElementsByTagName("button")[6].style.display = "none";
             else
                 question_box.getElementsByTagName("button")[6].style.display = "block";
             // 完成按钮的隐藏
             question_box.getElementsByTagName("button")[7].style.display = "none";
             // 隐藏所有选项
             for (let i=0;i<6;i++)
                 question_box.getElementsByTagName("button")[i].style.display = "none";
             // alert("optReload完成隐藏所有选项");

             // 更新本次序列的信息，q_all[order] 是 [问题,[选项1,c_1,c_2,c_3,c_4],[选项1,c_1,c_2,c_3,c_4]]

             if (order>q_all.length)
             {
                 question_box.getElementsByTagName("button")[7].style.display = "block";
                 // 更新问题变为结束背景
                 document.getElementById("question_text").textContent = "";
                 document.getElementById("img_left").src = "images/2.jpg"
                 // 选项因为是隐藏状态，所以不用更新

                 // 背景的更新
                 // background_box.getElementsByTagName("h2").textContent = "完成测试界面";
                 document.getElementById("complete_h2").textContent = "完成测试界面";
             }
             else
             {
                 // 更新背景
                 document.getElementById("img_left").src = "images/3.jpg";
                 //更新问题
                 // alert("开始更新问题");
                 document.getElementById("question_text").textContent = q_all[_order][0];
                 // alert(document.getElementById("question_text").textContent);
                 // alert("完成更新问题");
                 // q_all[order].length-1 是选项的个数
                 let opt_number = q_all[_order].length-1;
                 // 循环更新每个选项的属性,q_all[order][i+1]包含了选项的名称以及每个属性的分值
                for (let _i=0;_i<opt_number;_i++) {
                    // _i+1是选项数组的序号,因为q_all[order][0]是问题
                    // options = [opt_text,opt_score]
                    let options = question_box.getElementsByTagName("button")[_i];
                    options.style.display = "block"; // 更新显示选项
                    options.textContent = q_all[_order][_i+1][0]; //更新选项的文字信息
                    // 选项的分数
                    // alert("更新选项分数启动");
                    options.setAttribute("character_1", q_all[_order][_i+1][1]);
                    options.setAttribute("character_2", q_all[_order][_i+1][2]);
                    options.setAttribute("character_3", q_all[_order][_i+1][3]);
                    options.setAttribute("character_4", q_all[_order][_i+1][4]);
                    // alert("character_4: ");
                    // alert(options.getAttribute("character_4"));
                    // alert("更新选项分数完成");
                }
             }
         }

         // 根据分数判定需要显示的文字
         function figureOut(score_history, order){
             let score_1 = score_history[order-1][0];
             let score_2 = score_history[order-1][1];
             let score_3 = score_history[order-1][2];
             let score_4 = score_history[order-1][3];
             let tmp1 = (score_1>score_1) ? score_1:score_2;
             let tmp2 = (score_3>score_4) ? score_3:score_4;
             let max = (tmp1>tmp2)?tmp1:tmp2;
             document.getElementById("home_title").style.display = "none";
             document.getElementById("start_test").style.display= "none";
             document.getElementById("home_figure").style.display = "block";
             document.getElementById("register").style.display="block";
             document.getElementById("figure_exp").style.display="block";
             document.getElementById("con_right_h").style.display="none";
             document.getElementById("con_right_p").style.display="none";
             if (max===score_1){
                document.getElementById("home_figure").textContent = "低调执念者";
                document.getElementById("figure_exp").textContent = "小行动，大改变！我们日常中的生活习惯，都与地球生态息息相关，保护环境并非一日之事，需要我们每个人做一点点，从一件小事做起。你是绿色环保人格中的低调执念者，注重从生活中的节约环保开始，比如随手关灯，打包剩菜，节约用水。每一位低调执着者都是星空中的一颗颗小星星，点亮漫天灿烂。"
                document.getElementById("img_right").src = "images/1.png";
             }else if (max===score_2) {
                 document.getElementById("home_figure").textContent = "野生循环家";
                 document.getElementById("figure_exp").textContent = '变废为宝，分分秒秒。“垃圾是放错了地方的资源。“你是野生循环家，你有着对垃圾处置的强烈责任感，善于动脑与动手相结合，注重循环使用，例如循环使用塑料袋，自带咖啡机，快递纸箱回收'
                 document.getElementById("img_right").src = "images/2.png";
             }else if (max===score_3) {
                 document.getElementById("home_figure").textContent = "绿色买单人";
                 document.getElementById("figure_exp").textContent ="化消费力为环保力，崇尚自然，追求绿色环保，实现可持续消费。你是绿色买单人，有着独特的环保头脑，了解各种环保材料，环保工艺，积极支持绿色产品和品牌，你是绿色生产的大功臣。"
                 document.getElementById("img_right").src = "images/3.png";
             }else {
                 document.getElementById("home_figure").textContent = "积分收割机";
                 document.getElementById("figure_exp").textContent = "种树了吗？收能量了吗？保护地宣传了吗？日复一日地收割积分，可能只是想种一颗自己的树，可能只是想看看保护地有哪些可爱的小动物，你是积分的收割机，也是温情的守护者，以点滴积分，助力绿色环保。"
                 document.getElementById("img_right").src = "images/4.png";
             }
             // document.getElementById("")
             form_box.style.transform='translateX(0%)';
             question_box.classList.add('hidden');
             home_box.classList.remove('hidden');

         }

        // 要操作到的元素
        let login=document.getElementById('login');
        let start_test=document.getElementById('start_test');
        let last_question = document.getElementById('last_question');
        let form_box=document.getElementsByClassName('form-box')[0];
        let question_box=document.getElementsByClassName('question-box')[0];
        let home_box=document.getElementsByClassName('home-box')[0];
        // 要操作的按钮元素定义
        let select_a = document.getElementById("select_a");
        let select_b = document.getElementById("select_b");
        let select_c = document.getElementById("select_c");
        let select_d = document.getElementById("select_d");
        let select_e = document.getElementById("select_e");
        let select_f = document.getElementById("select_f");
        let complete_question = document.getElementById("complete_question");
        let start_again = document.getElementById("register");

        // 开始测试按钮点击事件
        start_test.addEventListener('click',()=>{
            order = 1;
            form_box.style.transform='translateX(80%)';
            home_box.classList.add('hidden');
            question_box.classList.remove('hidden');
            scoreInit(q_all.length+1, 6);
            optReload(q_all,order);
        });
        // 退出测试按钮点击事件
        login.addEventListener('click',()=>{
            // 将题目序号重置
            order = 1;
            // home页重置
            document.getElementById("home_title").style.display = "block";
            document.getElementById("start_test").style.display= "block";
            document.getElementById("home_figure").style.display = "none";
            document.getElementById("register").style.display="none";
            document.getElementById("figure_exp").style.display="none";
            // 控制页面移动
            form_box.style.transform='translateX(0%)';
            // 通过给对应表格添加或删除hidden属性实现表格切换
            question_box.classList.add('hidden');
            home_box.classList.remove('hidden');
        });
        // 上一题按钮点击事件
        last_question.addEventListener('click',()=>{
            // question_box.classList.add('hidden');
            // home_box.classList.remove('hidden');
            if (order>0)
                order = order-1;
            else console.error("order不能小于零");
            // alert("last 开始刷新");
            optReload(q_all, order);
            // alert("last 刷新完毕");
        });
        // // 创建扩展按钮事件
        // let select_f = document.getElementById("select_f");
        // select_f.addEventListener('click',()=>{
        //     let select_a = document.getElementById("select_a");
        //     select_a.textContent = "A-";
        // });

        // 创建各选项的点击事件
        select_a.addEventListener('click',()=>{
            order++;
            // alert("运行scoreCalC");
            // alert("更新opt前的character_4: ");
            // alert(select_a.getAttribute("character_4"));
            // 计算存在时序问题，由于optReload会将下一个题的分数进行更新，所以要先计算分数
            scoreCalc(order, select_a.getAttribute("character_1"),select_a.getAttribute("character_2"),select_a.getAttribute("character_3"),select_a.getAttribute("character_4"))
            optReload(q_all, order);
            // alert("更新opt后的character_4: ");
            // alert(select_a.getAttribute("character_4"));
        })
        // 创建各选项的点击事件
        select_b.addEventListener('click',()=>{
            order++;
            // alert("运行scoreCalC");
            scoreCalc(order, select_b.getAttribute("character_1"),select_b.getAttribute("character_2"),select_b.getAttribute("character_3"),select_b.getAttribute("character_4"))
            optReload(q_all, order);
        })
        // 创建各选项的点击事件
        select_c.addEventListener('click',()=>{
            order++;
            // alert("运行scoreCalC");
            scoreCalc(order, select_c.getAttribute("character_1"),select_c.getAttribute("character_2"),select_c.getAttribute("character_3"),select_c.getAttribute("character_4"))
            optReload(q_all, order);
        })
        // 创建各选项的点击事件
        select_d.addEventListener('click',()=>{
            order++;
            // alert("运行scoreCalC");
            scoreCalc(order, select_d.getAttribute("character_1"),select_d.getAttribute("character_2"),select_d.getAttribute("character_3"),select_d.getAttribute("character_4"))
            optReload(q_all, order);
        })
        // 创建各选项的点击事件
        select_e.addEventListener('click',()=>{
            order++;
            // alert("运行scoreCalC");
            scoreCalc(order, select_e.getAttribute("character_1"),select_e.getAttribute("character_2"),select_e.getAttribute("character_3"),select_e.getAttribute("character_4"))
            optReload(q_all, order);
        })
        // 创建各选项的点击事件
        select_f.addEventListener('click',()=>{
            order++;
            // alert("运行scoreCalC");
            scoreCalc(order, select_f.getAttribute("character_1"),select_f.getAttribute("character_2"),select_f.getAttribute("character_3"),select_f.getAttribute("character_4"))
            optReload(q_all, order);
        })
         complete_question.addEventListener('click', ()=>{
             // 刷新逻辑存在问题
             figureOut(score_history, order);
         })

         // 点击重新答题事件
         start_again.addEventListener('click',()=>{
             order=1;
             form_box.style.transform='translateX(80%)';
             home_box.classList.add('hidden');
             question_box.classList.remove('hidden');
             document.getElementById("img_right").src = "images/4.jpg";
             document.getElementById("con_right_h").style.display="block";
             document.getElementById("con_right_p").style.display="block";
             scoreInit(3, 6);
             optReload(q_all,order);
         })






    </script>
</body>

</html>